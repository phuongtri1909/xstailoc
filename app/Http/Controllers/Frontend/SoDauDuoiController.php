<?phpnamespace App\Http\Controllers\Frontend;use Illuminate\Http\Request;use App\Http\Controllers\Controller;use App\Models\Lottery;use App\Models\Province;use Cache;class SoDauDuoiController extends Controller{    public function SoDauDuoiXSMB()    {        $lastPage = Lottery::where('mien', 1)->orderBy('date', 'DESC')->paginate(20)->lastPage();        $xsmbs = Lottery::where('mien', 1)->orderBy('date', 'DESC')->take(20)->get();        return view('frontend.sodauduoi.xsmb', compact('xsmbs', 'lastPage'));    }    public function SoDauDuoiXSMB_XT()    {        $xsmbs = Lottery::where('mien', 1)->orderBy('date', 'DESC')->paginate(20);        $dataReturn = [            "template" => view('frontend.sodauduoi.xsmb-xem-them', compact('xsmbs'))->render(),        ];        return json_encode($dataReturn);    }    public function SoDauDuoiXSMN()    {        // lấy tổng số page        $total = Lottery::where('mien', 3)->select('date')->orderBy('date', 'DESC')->distinct()->get()->toArray();        $lastPage = floor(count($total) / 20);        // lấy mảng kết quả 7 ngày        $list_7day = Lottery::where('mien', 3)->select('date')->orderBy('date', 'DESC')->distinct()->take(20)->get();        $kqxsmns = array();        foreach ($list_7day as $item) {            $kqxsmns[$item->date] = Lottery::where('mien', 3)->where('date', $item->date)->get();        }        return view('frontend.sodauduoi.xsmn', compact('kqxsmns', 'lastPage'));    }    public function SoDauDuoiXSMN_XT(Request $request)    {        $skip = $request->skip;        // lấy mảng kết quả 7 ngày        $list_7day = Lottery::where('mien', 3)->select('date')->orderBy('date', 'DESC')->distinct()->skip($skip)->take(7)->get();        $kqxsmns = array();        foreach ($list_7day as $item) {            $kqxsmns[$item->date] = Lottery::where('mien', 3)->where('date', $item->date)->get();        }        $dataReturn = [            "template" => view('frontend.sodauduoi.xsmn-xem-them', compact('kqxsmns'))->render(),        ];        return json_encode($dataReturn);    }    public function SoDauDuoiXSMT()    {        // lấy tổng số page        $total = Lottery::where('mien', 2)->select('date')->orderBy('date', 'DESC')->distinct()->get()->toArray();        $lastPage = floor(count($total) / 20);        // lấy mảng kết quả 7 ngày        $list_7day = Lottery::where('mien', 2)->select('date')->orderBy('date', 'DESC')->distinct()->take(20)->get();        $kqxsmts = array();        foreach ($list_7day as $item) {            $kqxsmts[$item->date] = Lottery::where('mien', 2)->where('date', $item->date)->get();        }        $day = getThuNumber(date('Y-m-d'));        $arr_province = Province::where('mien', 2)->where('ngay_quay', 'like', '%' . $day . '%')->get();        return view('frontend.sodauduoi.xsmt', compact('kqxsmts', 'lastPage', 'arr_province'));    }    public function SoDauDuoiXSMT_XT(Request $request)    {        $skip = $request->skip;        // lấy mảng kết quả 7 ngày        $list_7day = Lottery::where('mien', 2)->select('date')->orderBy('date', 'DESC')->distinct()->skip($skip)->take(20)->get();        $kqxsmts = array();        foreach ($list_7day as $item) {            $kqxsmts[$item->date] = Lottery::where('mien', 2)->where('date', $item->date)->get();        }        $dataReturn = [            "template" => view('frontend.sodauduoi.xsmt-xem-them', compact('kqxsmts'))->render(),        ];        return json_encode($dataReturn);    }}